[build]
  command = "npx expo export:web && cp public/app-ads.txt web-build/app-ads.txt && cp -r public/.well-known web-build/ && cp -r public/pages web-build/"
  publish = "web-build"

[functions]
  directory = "netlify/functions"

[build.environment]
  NODE_VERSION = "20"

# Serve app-ads.txt with correct headers
[[headers]]
  for = "/app-ads.txt"
  [headers.values]
    Content-Type = "text/plain"
    Access-Control-Allow-Origin = "*"
    Cache-Control = "public, max-age=3600"

# Serve apple-app-site-association without .json extension
[[headers]]
  for = "/.well-known/apple-app-site-association"
  [headers.values]
    Content-Type = "application/json"
    Access-Control-Allow-Origin = "*"

# Exclude app-ads.txt from SPA redirect
[[redirects]]
  from = "/app-ads.txt"
  to = "/app-ads.txt"
  status = 200

# Serve static blog posts and pages (don't redirect to SPA)
[[redirects]]
  from = "/pages/*"
  to = "/pages/:splat"
  status = 200

# SPA fallback - must be last
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
